name: Check Has Semver Label

on:
  workflow_call:
    inputs:
      pull-request:
        type: string
        description: |
          The PR JSON payload, as string. We're only checking for labels, so as long as the labels fields follow the
          schema of PRs as described [here](https://docs.github.com/en/webhooks/webhook-events-and-payloads#pull_request),
          it'll be all right. It defaults github.event.pull_request. If this field is undefined, it throws.
        required: false
    outputs:
      matched-label:
        description: |
          The matched semantic versioning label. There will only be one.
        value: ${{ jobs.check-has-semver-label.outputs.matched-label }}

permissions:
  pull-requests: write

jobs:
  check-has-semver-label:
    runs-on: ubuntu-22.04
    permissions:
      pull-requests: write
    outputs:
      matched-label: ${{ steps.check-labels.outputs.matched-labels }}
    steps:
      - uses: infrastructure-blocks/check-labels-action@v1
        id: check-labels
        with:
          pull-request: ${{ inputs.pull-request }}
          one-of: no version, patch, minor, major
      - if: ${{ failure() }}
        uses: infrastructure-blocks/status-report-action@v1
        with:
          repository: infrastructure-blocks/check-has-semver-label-workflow
          body: |
            :boom: **Error**: expecting exactly one semantic versioning PR label. Please provide one of "no version", "patch", "minor", "major"
